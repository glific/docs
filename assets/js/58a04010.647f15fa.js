"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5124],{3885:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>t,toc:()=>p});const t=JSON.parse('{"id":"Integrations/Structured responses in GPT webhook functions","title":"Structured responses in GPT webhook functions","description":"### 5 minutes read &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Advanced","source":"@site/docs/4. Integrations/Structured responses in GPT webhook functions.md","sourceDirName":"4. Integrations","slug":"/Integrations/Structured responses in GPT webhook functions","permalink":"/docs/docs/Integrations/Structured responses in GPT webhook functions","draft":false,"unlisted":false,"editUrl":"https://github.com/glific/docs/tree/main/docs/4. Integrations/Structured responses in GPT webhook functions.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Setting up Exotel","permalink":"/docs/docs/Integrations/Setting up Exotel"},"next":{"title":"FAQ","permalink":"/docs/docs/category/faq"}}');var o=n(4848),r=n(8453);const i={},a=void 0,c={},p=[{value:"<strong>5 minutes read \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 <code>Advanced</code></strong>",id:"5-minutes-read-------------------------------------------------------------advanced",level:3},{value:"Introduction",id:"introduction",level:2},{value:"Using structured responses in webhook",id:"using-structured-responses-in-webhook",level:3},{value:"Examples",id:"examples",level:2},{value:"json_object",id:"json_object",level:3},{value:"json_schema",id:"json_schema",level:3},{value:"Resources",id:"resources",level:2}];function h(e){const s={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",p:"p",strong:"strong",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(s.blockquote,{children:["\n",(0,o.jsx)(s.h3,{id:"5-minutes-read-------------------------------------------------------------advanced",children:(0,o.jsxs)(s.strong,{children:["5 minutes read \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 ",(0,o.jsx)(s.code,{children:"Advanced"})]})}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"Reliably get json responses from parse_via_chat_gpt and parse_via_gpt_vision webhook functions"}),"\n",(0,o.jsx)(s.h2,{id:"introduction",children:"Introduction"}),"\n",(0,o.jsxs)(s.p,{children:["If the webhook call type is POST/GET then we expect the response from external apis to be json.\nBut we are not doing this for the webhook type ",(0,o.jsx)(s.code,{children:"FUNCTION"}),", since the response from the functions (especially LLMs) is not reliable such that they return json everytime correctly.\nDue to this we store the response of the function as a string. Due to this even if they are returning proper json we store it as a string, and we don't try to parse it."]}),"\n",(0,o.jsxs)(s.p,{children:["Recently openAI added a new feature called ",(0,o.jsx)(s.a,{href:"https://openai.com/index/introducing-structured-outputs-in-the-api/",children:"structured responses"})," in which we can give the expected response schema in the request itself, thus we can have responses in reliable json formats.\nWe are leveraging this and parsing the response, if its json then add the key-value pairs to the results variable."]}),"\n",(0,o.jsx)(s.h3,{id:"using-structured-responses-in-webhook",children:"Using structured responses in webhook"}),"\n",(0,o.jsxs)(s.p,{children:["We have to add an optional param called ",(0,o.jsx)(s.code,{children:"response_format"})," in the existing ",(0,o.jsx)(s.code,{children:"parse_via_gpt_vision/parse_via_chat_gpt"})," webhook body."]}),"\n",(0,o.jsxs)(s.p,{children:["The value of ",(0,o.jsx)(s.code,{children:"response_format"})," will be the same as what openAI needs in their apis, you can read it ",(0,o.jsx)(s.a,{href:"https://platform.openai.com/docs/api-reference/chat/create#chat-create-response_format",children:"here"}),"."]}),"\n",(0,o.jsxs)(s.p,{children:["In short, if the value is ",(0,o.jsx)(s.code,{children:'{"type": "json_object"}'}),", and the prompt has a ",(0,o.jsx)(s.code,{children:"json"})," keyword, then the response will always be a json. Or if the value is ",(0,o.jsx)(s.code,{children:'{"type": "json_schema"}'}),", then we have to pass the schema as mentioned in the ",(0,o.jsx)(s.a,{href:"https://platform.openai.com/docs/api-reference/chat/create#chat-create-response_format",children:"openAI docs"}),"."]}),"\n",(0,o.jsx)(s.p,{children:"For both we will get a valid json from the openAI, and those will be merged into the results variable."}),"\n",(0,o.jsx)(s.h2,{id:"examples",children:"Examples"}),"\n",(0,o.jsx)(s.h3,{id:"json_object",children:"json_object"}),"\n",(0,o.jsx)("img",{width:"564",alt:"image",src:"https://github.com/user-attachments/assets/da1bbf22-2ee4-4419-a882-d9313073b726"}),"\n",(0,o.jsx)(s.p,{children:"And the corresponding webhook response we get will be"}),"\n",(0,o.jsx)("img",{width:"559",alt:"image",src:"https://github.com/user-attachments/assets/7785090b-6280-42ef-8c8a-08006b4e1439"}),"\n",(0,o.jsx)("img",{width:"570",alt:"image",src:"https://github.com/user-attachments/assets/bbca9013-fa3d-4c16-88e9-cbd4a171d7fe"}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"WARNING:"})," If we are using ",(0,o.jsx)(s.code,{children:"json_object"})," as ",(0,o.jsx)(s.code,{children:"response_format"}),", then the response will be always json but there\u2019s no reliability that the keys will be same always. For ex in the next run the key \u201cVolunteer ID\u201d can be \u201cVolunteerID\u201d unless states explicitly in the prompt."]}),"\n",(0,o.jsx)(s.h3,{id:"json_schema",children:"json_schema"}),"\n",(0,o.jsxs)(s.p,{children:["For the same prompt above the ",(0,o.jsx)(s.code,{children:"response_format"})," would be something like"]}),"\n",(0,o.jsx)("img",{width:"560",alt:"image",src:"https://github.com/user-attachments/assets/12d65963-8895-46eb-b85b-90ad23ebc0f2"}),"\n",(0,o.jsx)("img",{width:"564",alt:"image",src:"https://github.com/user-attachments/assets/dd0e31af-f28f-47cd-8441-b0499bf51619"}),"\n",(0,o.jsxs)(s.p,{children:["The Pros of ",(0,o.jsx)(s.code,{children:"json_schema"})," wrto ",(0,o.jsx)(s.code,{children:"json_object"})," is that, the json keys will be always deterministic as specified in the schema."]}),"\n",(0,o.jsx)(s.h2,{id:"resources",children:"Resources"}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.a,{href:"https://openai.com/index/introducing-structured-outputs-in-the-api/",children:"https://openai.com/index/introducing-structured-outputs-in-the-api/"}),"\n",(0,o.jsx)(s.a,{href:"https://platform.openai.com/docs/api-reference/chat/create#chat-create-response_format",children:"https://platform.openai.com/docs/api-reference/chat/create#chat-create-response_format"})]})]})}function d(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>i,x:()=>a});var t=n(6540);const o={},r=t.createContext(o);function i(e){const s=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);