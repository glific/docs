"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8970],{1721:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"Product Features/Flows/Flow Actions/Split By/Custom Expression","title":"Custom Expression","description":"4 minutes read","source":"@site/docs/4. Product Features/03. Flows/2. Flow Actions/Split By/01. Custom Expression.md","sourceDirName":"4. Product Features/03. Flows/2. Flow Actions/Split By","slug":"/Product Features/Flows/Flow Actions/Split By/Custom Expression","permalink":"/docs/docs/Product Features/Flows/Flow Actions/Split By/Custom Expression","draft":false,"unlisted":false,"editUrl":"https://github.com/glific/docs/tree/main/docs/4. Product Features/03. Flows/2. Flow Actions/Split By/01. Custom Expression.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Manage profile","permalink":"/docs/docs/Product Features/Flows/Flow Actions/Manage profile"},"next":{"title":"Contact Field","permalink":"/docs/docs/Product Features/Flows/Flow Actions/Split By/Contact Field"}}');var i=n(4848),a=n(8453);const c={},r="Split by Custom Expression",o={},d=[{value:"Custom Expressions cheatsheet",id:"custom-expressions-cheatsheet",level:2},{value:"1. Get Today&#39;s Date (IST\u200b)",id:"1-get-todays-date-ist",level:3},{value:"2. Get Today&#39;s Date and Time (IST)\u200b",id:"2-get-todays-date-and-time-ist",level:3},{value:"3. Adding the Date and Time Stamp",id:"3-adding-the-date-and-time-stamp",level:3},{value:"4. Calculating the Time Difference",id:"4-calculating-the-time-difference",level:3},{value:"5. Calculating the Difference Between Two Dates",id:"5-calculating-the-difference-between-two-dates",level:3},{value:"6. Concatenating Strings or Variables",id:"6-concatenating-strings-or-variables",level:3},{value:"7. Converting a string to lowercase.",id:"7-converting-a-string-to-lowercase",level:3},{value:"8. Validating Date Format and Range",id:"8-validating-date-format-and-range",level:3},{value:"9. Validating Time Format (24 Hour)",id:"9-validating-time-format-24-hour",level:3},{value:"Advanced Syntax Examples",id:"advanced-syntax-examples",level:2},{value:"Advanced Feature Webinar",id:"advanced-feature-webinar",level:3}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h3",{children:(0,i.jsx)("table",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(0,i.jsx)("b",{children:"4 minutes read"})}),(0,i.jsx)("td",{style:{paddingLeft:40},children:(0,i.jsx)("b",{children:" Level: Intermediate"})}),(0,i.jsx)("td",{style:{paddingLeft:40},children:(0,i.jsx)("b",{children:"Last Updated: October 2025"})})]})})}),"\n",(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"split-by-custom-expression",children:"Split by Custom Expression"})}),"\n",(0,i.jsx)(t.p,{children:"In certain flows, it is necessary to deliver different responses to different contacts based on their previous selections or stored profile attributes, such as location, batch start date, or opt-in status."}),"\n",(0,i.jsx)(t.p,{children:"The Custom Expression is useful in scenarios where it is necessary to:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Branch the flow according to a contact\u2019s attribute values"}),"\n",(0,i.jsx)(t.li,{children:"Compare dates or times"}),"\n",(0,i.jsx)(t.li,{children:"Perform calculations within the flow (for example, days since registration)"}),"\n",(0,i.jsx)(t.li,{children:"Combine multiple variables into a single output"}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Split by a custom expression` uses a coding syntax to match the response received or profile attribute."}),"\n",(0,i.jsxs)(t.p,{children:["The expression follows a format such as:\n",(0,i.jsx)(t.code,{children:'<%= if (variable_name == "string" or number), do: 1, else: 0 %>'})]}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h2,{id:"custom-expressions-cheatsheet",children:"Custom Expressions cheatsheet"}),"\n",(0,i.jsx)(t.h3,{id:"1-get-todays-date-ist",children:"1. Get Today's Date (IST\u200b)"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.code,{children:'<%= Timex.today("Asia/Kolkata") |> Date.to_string() %>'})}),"\n",(0,i.jsx)(t.h3,{id:"2-get-todays-date-and-time-ist",children:"2. Get Today's Date and Time (IST)\u200b"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.code,{children:'<%= DateTime.now!("Asia/Kolkata") |> DateTime.to_string() %>'})}),"\n",(0,i.jsx)(t.h3,{id:"3-adding-the-date-and-time-stamp",children:"3. Adding the Date and Time Stamp"}),"\n",(0,i.jsxs)(t.p,{children:["To capture the date and time. Example - start time of a flow and the end time of a flow, following custom expression can be used\n",(0,i.jsx)(t.code,{children:'<%= DateTime.now!("Asia/Kolkata") |> Calendar.strftime("%H:%M:%S") %>'})]}),"\n",(0,i.jsx)(t.p,{children:"Add a Update Contact node and pass the mentioned expression."}),"\n",(0,i.jsx)("img",{width:"471",height:"269",alt:"Screenshot 2025-10-08 at 4 23 11\u202fPM",src:"https://github.com/user-attachments/assets/77bcee5b-2e51-44d9-acd4-52c35d6a807f"}),"\n",(0,i.jsx)(t.h3,{id:"4-calculating-the-time-difference",children:"4. Calculating the Time Difference"}),"\n",(0,i.jsx)(t.p,{children:"Use case: To calculate the time taken by a contact to complete the flow. Considering the prerequisite that the start time and end time are captured at the flow level in separate variables, the difference can be calculated using the following expression."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.code,{children:'<%= Time.diff(Time.from_iso8601!("@contact.fields.time_end"), Time.from_iso8601!("@contact.fields.time_start"), :second) %>'})}),"\n",(0,i.jsxs)(t.p,{children:["The above expression calculates the difference between ",(0,i.jsx)(t.code,{children:"@contact.fields.time_end"})," and ",(0,i.jsx)(t.code,{children:"@contact.fields.time_start"})," in seconds. And the screenshot below updates this difference to a contact variable ",(0,i.jsx)(t.code,{children:"@contact.fields.timer"})," using update the contact node."]}),"\n",(0,i.jsx)("img",{width:"466",height:"267",alt:"Screenshot 2025-10-08 at 4 26 00\u202fPM",src:"https://github.com/user-attachments/assets/69c0960b-44e8-4297-98d0-75eaf96ab4d4"}),"\n",(0,i.jsx)(t.h3,{id:"5-calculating-the-difference-between-two-dates",children:"5. Calculating the Difference Between Two Dates"}),"\n",(0,i.jsxs)(t.p,{children:["Use case: Calculating the date difference between the current date and a given date (e.g., batch start date or onboarding date of the contact). Here, ",(0,i.jsx)(t.code,{children:"@calendar.current_date"})," is used to store the batch start date at the time of onboarding.\n",(0,i.jsx)(t.code,{children:"@calendar.current_date"})," returns the date in the format D/0M/YYYY, where:\nD = day without a leading zero\n0M = month with a leading zero\nYYYY = full numeric year"]}),"\n",(0,i.jsx)(t.p,{children:"For example:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"2nd January 2025 \u2192 2/01/2025"}),"\n",(0,i.jsx)(t.li,{children:"11th October 2024 \u2192 11/10/2024"}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["The following expression can be used to calculate the difference in days between the current date and the stored batch start date:\n",(0,i.jsx)(t.code,{children:'<%= "@contact.fields.batch_start_date"|>Timex.parse!("{D}/{0M}/{YYYY}") |> then(&(Timex.diff(Timex.now(), &1, :day))) %>'})]}),"\n",(0,i.jsxs)(t.p,{children:["In the screenshot, this expression calculates the date difference and updates the value to a new flow result: ",(0,i.jsx)(t.code,{children:"@results.datediff"})]}),"\n",(0,i.jsx)("img",{width:"470",height:"390",alt:"Screenshot 2025-10-08 at 4 34 44\u202fPM",src:"https://github.com/user-attachments/assets/9a12497c-ce92-4536-9f24-e027776167ee"}),"\n",(0,i.jsx)(t.h3,{id:"6-concatenating-strings-or-variables",children:"6. Concatenating Strings or Variables"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"To combine two variables in a contact field."}),"\n",(0,i.jsxs)(t.li,{children:["In the given example, ",(0,i.jsx)(t.code,{children:"@results.Var1"})," ",(0,i.jsx)(t.code,{children:"@results.Var2"})," are joined."]}),"\n"]}),"\n",(0,i.jsx)("img",{width:"466",height:"259",alt:"Screenshot 2025-10-08 at 4 36 06\u202fPM",src:"https://github.com/user-attachments/assets/f45036d9-a66c-458d-adb9-e8e4dc189665"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Use Case: Suppose ",(0,i.jsx)(t.code,{children:"@results.grade.category"})," contains the value 2 and ",(0,i.jsx)(t.code,{children:"@contact.fields.s_acp"})," contains the value 4, then the the value of the ",(0,i.jsx)(t.code,{children:"@contact.fields.present_grade_acp"})," is updated to value of \u201c",(0,i.jsx)(t.strong,{children:"Grade 2 ACP 4"}),"\u201d, By simply writing Grade ",(0,i.jsx)(t.code,{children:"@results.grade.category"})," ACP ",(0,i.jsx)(t.code,{children:"@contact.fields.s_acp"})," to update a contact field called ",(0,i.jsx)(t.code,{children:"present_grade_acp"}),"."]}),"\n"]}),"\n",(0,i.jsx)("img",{width:"460",height:"262",alt:"Screenshot 2025-10-08 at 4 38 23\u202fPM",src:"https://github.com/user-attachments/assets/4d4a5e8e-2626-477b-891e-31bd9788f243"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Similarly, other example of concatenating the node is the following node which Updates the value of ",(0,i.jsx)(t.code,{children:"@contact.fields.cumulative_acp"})]}),"\n",(0,i.jsxs)(t.li,{children:["By adding a comma and the value contained in ",(0,i.jsx)(t.code,{children:"@contact.fields.present_grade_acp"})," to the already existing values in ",(0,i.jsx)(t.code,{children:"@contact.fields.cumulative_acp"})]}),"\n",(0,i.jsxs)(t.li,{children:["Suppose the ",(0,i.jsx)(t.code,{children:"@contact.fields.cumulative_acp"})," is set to 0, and suppose the value of ",(0,i.jsx)(t.code,{children:"@contact.fields.present_grade_acp"})," contains the value Grade 1 ACP 1, then after the node is encountered, the updated value of ",(0,i.jsx)(t.code,{children:"@contact.fields.cumulative_acp"})," becomes ",(0,i.jsx)(t.strong,{children:"0, Grade 2 ACP 1"})]}),"\n",(0,i.jsxs)(t.li,{children:["In the next flow, if the ",(0,i.jsx)(t.code,{children:"@contact.fields.present_grade_acp"})," contains the value Grade 1 ACP 2, then after encountering the same node, the value of @contact.fields.cumulative_acp is updated to ",(0,i.jsx)(t.strong,{children:"0, Grade 1 ACP 1, Grade 2 ACP 1"})]}),"\n",(0,i.jsx)(t.li,{children:"In this way, a contact variable can be used to store the history of progression/ paths taken by a contact."}),"\n"]}),"\n",(0,i.jsx)("img",{width:"464",height:"262",alt:"Screenshot 2025-10-08 at 4 43 44\u202fPM",src:"https://github.com/user-attachments/assets/8abcfeec-ef6a-4da0-afc7-b9bb96261430"}),"\n",(0,i.jsx)(t.h3,{id:"7-converting-a-string-to-lowercase",children:"7. Converting a string to lowercase."}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Any input variable can be converted to lowercase by using the following expression:\n",(0,i.jsx)(t.code,{children:"<%= String.downcase(\u201c@results.resultname\u201d) %>"})]}),"\n",(0,i.jsxs)(t.li,{children:["In the above expression ",(0,i.jsx)(t.code,{children:"@results.resultname"})," can be replaced with the string or the flow variable or the contact variable containing the string that needs to be converted to lowercase."]}),"\n",(0,i.jsxs)(t.li,{children:["In the screenshot given below, two tasks are happening at once The flow variable ",(0,i.jsx)(t.code,{children:"@results.flow_keyword.input"})," is getting converted to the lowercase The lowercase value of flow variable ",(0,i.jsx)(t.code,{children:"@results.flow_keyword.input"})," is getting saved to the contact variable keyword"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Use case: Same flow can be started using multiple keywords. The keyword entered by a contact is used to determine which partner org, city and school is the contact representing. This data is picked up from a separate google sheet maintained by the NGO. Thus reducing the step by the contact to share details like org, school name, city."}),"\n",(0,i.jsx)("img",{width:"471",height:"268",alt:"Screenshot 2025-10-08 at 4 47 58\u202fPM",src:"https://github.com/user-attachments/assets/8f33cedb-6ccd-439d-9ca5-61d94ac8dde0"}),"\n",(0,i.jsx)(t.h3,{id:"8-validating-date-format-and-range",children:"8. Validating Date Format and Range"}),"\n",(0,i.jsxs)(t.p,{children:["WhatsApp interface does not enable providing a calendar menu to select and enter dates. In order to accomplish collection of cleaner date format, following custom expression can be used:\nTo capture the date in DD/MM/YYYY format(Validating date input using ",(0,i.jsx)(t.code,{children:"Split By"})," or ",(0,i.jsx)(t.code,{children:"Wait for Response"}),")"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Use ",(0,i.jsx)(t.code,{children:"split by"})," node or in the ",(0,i.jsx)(t.code,{children:"wait for response"})," include the validation condition for ",(0,i.jsx)(t.code,{children:"matches regex"})," and check the following . In the given example ",(0,i.jsx)(t.code,{children:"split by"})," was used with the following regex:"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.code,{children:"^(0[1-9]|[12][0-9]|3[01])/(0[1-9]|1[0-2])/(?:202[5-9]|2030)$"})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"How it works:"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"(0[1-9]|[12][0-9]|3[01])"}),"  - Ensures the DD value (numbers before the /) is between 01 and 31."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"(0[1-9]|1[0-2])"}),"  - Ensures the MM value does not exceed 12."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"(?:202[5-9]|2030)"})," - Ensures the YYYY value is between 2025 and 2030."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Customisation: You can modify the regex to match other formats, such as MM/DD/YYYY or DD-MM-YYYY, by adjusting the sequence and separators accordingly."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)("img",{width:"577",height:"392",alt:"Screenshot 2025-10-08 at 4 57 26\u202fPM",src:"https://github.com/user-attachments/assets/76f3a8ea-ff6b-4a92-a872-a120e124f20c"}),"\n",(0,i.jsx)(t.h3,{id:"9-validating-time-format-24-hour",children:"9. Validating Time Format (24 Hour)"}),"\n",(0,i.jsxs)(t.p,{children:["Users can use a ",(0,i.jsx)(t.code,{children:"Split By"})," node or, in a ",(0,i.jsx)(t.code,{children:"Wait for Response"})," node, include a validation condition with ",(0,i.jsx)(t.code,{children:"Matches Regex"})," to validate time inputs.\nIn the given example, the regex used is:\n",(0,i.jsx)(t.code,{children:"([01][0-9]|2[0-3]):([0-5][0-9])$"})]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"How it works:"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"([01][0-9]|2[0-3])"})," \u2192 Ensures the hour value is between 00 and 23."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"([0-5][0-9])"})," \u2192 Ensures the minutes value is between 00 and 59."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:":"})," \u2192 The colon acts as the delimiter between hours and minutes."]}),"\n"]}),"\n",(0,i.jsx)("img",{width:"582",height:"400",alt:"Screenshot 2025-10-08 at 4 59 57\u202fPM",src:"https://github.com/user-attachments/assets/6f345f13-af10-43fa-9a3d-759794c60523"}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h2,{id:"advanced-syntax-examples",children:"Advanced Syntax Examples"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["Syntax to check if contact belongs to a specific collection (collection 1 or collection 2)\n",(0,i.jsx)(t.code,{children:'<%= if "collection 1" in @contact.in_groups, do: 1, else: if "collection 2" in @contact.in_groups, do: 2, else: 3 %>'})]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Add a ",(0,i.jsx)(t.code,{children:"Split by expression"})," node and the above mentioned expression."]}),"\n",(0,i.jsx)("img",{width:"575",height:"443",alt:"Screenshot 2025-10-08 at 5 02 07\u202fPM",src:"https://github.com/user-attachments/assets/c72940ec-f2a7-4dd6-99b7-23cf528445ec"}),"\n",(0,i.jsxs)(t.ol,{start:"2",children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Syntax to check if the contact is registered or not.\n",(0,i.jsx)(t.code,{children:'<%= if "@contact.fields.is_registered" == "1" , do: 1, else: 0 %>'})]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Syntax to check if the contact has opted-in or not.\n",(0,i.jsx)(t.code,{children:"<%= if @contact.optin_status == true, do: 1, else: 2%>"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)("img",{width:"582",height:"448",alt:"Screenshot 2025-10-08 at 5 03 04\u202fPM",src:"https://github.com/user-attachments/assets/98da59b3-0b6a-4f2c-9752-75459c43c15d"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Any variable created and saved can be used to make decisions within a ",(0,i.jsx)(t.code,{children:"Split By custom expression"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:["Writing the correct syntax for a ",(0,i.jsx)(t.code,{children:"Split By expression"})," requires some coding knowledge. If you have specific requirements or need help crafting the right expression, please reach out to us on ",(0,i.jsx)(t.a,{href:"https://discord.com/channels/717975833226248303/1037981805653008404",children:"Discord"}),". We\u2019ll be happy to share the exact syntax tailored to your needs."]}),"\n"]}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h3,{id:"advanced-feature-webinar",children:"Advanced Feature Webinar"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.a,{href:"https://www.youtube.com/watch?v=nl7n6l_LLec&t=14s",children:"Video Link"})})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>c,x:()=>r});var s=n(6540);const i={},a=s.createContext(i);function c(e){const t=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(a.Provider,{value:t},e.children)}}}]);