"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9026],{5413:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>a,toc:()=>h});var t=n(4848),i=n(8453);const o={},r=void 0,a={id:"Use Cases/Solving For Sheet Sync Failures Issues",title:"Solving For Sheet Sync Failures Issues",description:"5 minute read &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Advanced",source:"@site/docs/Use Cases/Solving For Sheet Sync Failures Issues.md",sourceDirName:"Use Cases",slug:"/Use Cases/Solving For Sheet Sync Failures Issues",permalink:"/docs/docs/Use Cases/Solving For Sheet Sync Failures Issues",draft:!1,unlisted:!1,editUrl:"https://github.com/glific/docs/tree/main/docs/Use Cases/Solving For Sheet Sync Failures Issues.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"How To Set Up HSM Delivery Dashboard",permalink:"/docs/docs/Use Cases/How To Set Up HSM Delivery Dashboard"},next:{title:"Use of Google Sheets To Update Contact Variables",permalink:"/docs/docs/Use Cases/Use of Google Sheets To Update Contact Variables"}},l={},h=[{value:"<strong>5 minute read \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 <code>Advanced</code></strong>",id:"5-minute-read-------------------------------------------------------------advanced",level:3},{value:"Solving For Sheet Sync Failures for Large WhatsApp Nudging Campaigns in Glific",id:"solving-for-sheet-sync-failures-for-large-whatsapp-nudging-campaigns-in-glific",level:2},{value:"Summary",id:"summary",level:3},{value:"Context",id:"context",level:3},{value:"The Problem",id:"the-problem",level:3},{value:"The Solution: A Google App Script to Handle Syncs",id:"the-solution-a-google-app-script-to-handle-syncs",level:3},{value:"How the solution works",id:"how-the-solution-works",level:4},{value:"Implementation Steps",id:"implementation-steps",level:3},{value:"Step 1: Prepare Your Google Sheet",id:"step-1-prepare-your-google-sheet",level:4},{value:"Step 2: Set Up the Google App Script",id:"step-2-set-up-the-google-app-script",level:4},{value:"Step 3: Set up a Trigger to Run Daily",id:"step-3-set-up-a-trigger-to-run-daily",level:4},{value:"Benefits",id:"benefits",level:3}];function c(e){const s={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h3,{id:"5-minute-read-------------------------------------------------------------advanced",children:(0,t.jsxs)(s.strong,{children:["5 minute read \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 ",(0,t.jsx)(s.code,{children:"Advanced"})]})}),"\n",(0,t.jsx)(s.h2,{id:"solving-for-sheet-sync-failures-for-large-whatsapp-nudging-campaigns-in-glific",children:"Solving For Sheet Sync Failures for Large WhatsApp Nudging Campaigns in Glific"}),"\n",(0,t.jsx)(s.h3,{id:"summary",children:"Summary"}),"\n",(0,t.jsx)(s.p,{children:"If you're facing issues with large-scale Google Sheet syncs for nudging via Glific, or any other use case, which requires you to sync specific sheets in an automated way, or sync sheets which have data getting refreshed more than once a day, this Google App Script method provides a scalable and reliable workaround. With proper retries, logging, and notifications built-in, it ensures you reach your audience without manual intervention."}),"\n",(0,t.jsx)(s.h3,{id:"context",children:"Context"}),"\n",(0,t.jsx)(s.p,{children:"This is an example taken from Leadership for Equity (LFE). They run nudging campaigns to engage teachers through WhatsApp using the Glific chatbot. These nudges aim to push teachers forward on their Firki Learning Management System (LMS) journey. For example:\nNudging those who haven\u2019t started their courses"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Encouraging teachers who haven\u2019t made progress in a while"}),"\n",(0,t.jsx)(s.li,{children:"Congratulating those who completed a module"}),"\n",(0,t.jsx)(s.li,{children:"This campaign has scaled to 15,000+ teachers, requiring frequent (1-3 times/week) and personalized communication based on LMS status. (which means data pull for each teachers\u2019 message to share data specific to observations made them, or journey undertaken by them in the LMS."}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Another example is from Saturday Art Class, which provides grade specific art lesson plans (PDF files). The teachers across Nagaland and more geographies, need to access plans specific to them"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Grades ranging from Nursery to 8th"}),"\n",(0,t.jsx)(s.li,{children:"Lesson plan based on language preference"}),"\n",(0,t.jsx)(s.li,{children:"Lesson plan in sequence"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"The problem arises when the sheets linked in these flows failt to auto-sync, which render these flows useless. The workaround is to manually sync the sheet."}),"\n",(0,t.jsx)(s.h3,{id:"the-problem",children:"The Problem"}),"\n",(0,t.jsx)(s.p,{children:"Glific supports timely auto-syncing (once a day between 6-7am) of Google Sheets. However, with large google sheets, the auto-sync feature becomes unreliable because of the following reasons:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"All the google sheets across the 100+ orgs sync around the same time"}),"\n",(0,t.jsx)(s.li,{children:"If the sync fails, the re-try mechanism does not kick in (although, progress has been made towards this issue)"}),"\n",(0,t.jsx)(s.li,{children:"As the size of the sheets increase (length or breadth) the chances of sync completion successfully reduce (possibly due to timeout)"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"This is in a way a big problem because, when the sheet sync fails, the data from the sheet is first fully erased, and only in the next step the data is synced. Which means, the flows which use these sheet become useful and fail to send any content."}),"\n",(0,t.jsx)(s.h3,{id:"the-solution-a-google-app-script-to-handle-syncs",children:"The Solution: A Google App Script to Handle Syncs"}),"\n",(0,t.jsx)(s.p,{children:"Use the Glific APIs to call sync a sheet specific to your org."}),"\n",(0,t.jsx)(s.p,{children:"This helps in the following ways"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Only your org\u2019s sheets are synced, which reduces the load on the system and therefore the chances of syncing even large sheets is increased."}),"\n",(0,t.jsx)(s.li,{children:"There is a re-try mechanism which re-tries at least 3 times in case of a failure, and notifies you via email in case the sheet sync fails."}),"\n",(0,t.jsx)(s.li,{children:"You can decide the time and frequency of sheet sync by using time-driven \u201ctriggers\u201d which is a AppScript functionality."}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"how-the-solution-works",children:"How the solution works"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Authenticates with Glific (log-in username & password)"}),"\n",(0,t.jsx)(s.li,{children:"Reads a list of sheet IDs to sync (from a column where you can add or remove)"}),"\n",(0,t.jsx)(s.li,{children:"Calls Glific\u2019s syncSheet GraphQL API"}),"\n",(0,t.jsx)(s.li,{children:"Handles errors, retries up to 3 times, and logs sync status"}),"\n",(0,t.jsx)(s.li,{children:"Sends email alerts if sync fails after retries (to an email id you can specify)"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"This script has successfully handled sheets with 14k+ rows and works more reliably than Glific auto-sync function or manual Postman workflows."}),"\n",(0,t.jsx)(s.h3,{id:"implementation-steps",children:"Implementation Steps"}),"\n",(0,t.jsx)(s.h4,{id:"step-1-prepare-your-google-sheet",children:"Step 1: Prepare Your Google Sheet"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Go to this ",(0,t.jsx)(s.a,{href:"https://docs.google.com/spreadsheets/d/1t2wDjZ8h5ukEm7ZBmxhTnNKPezFecgcMMSpwZ88kMOc/copy",children:"link"}),". This should create a copy of the template google sheet with the app script"]}),"\n",(0,t.jsxs)(s.li,{children:["Add the linked google sheet id in the column A of the ",(0,t.jsx)(s.code,{children:"SheetList"})," tab."]}),"\n",(0,t.jsxs)(s.li,{children:["Any number of ",(0,t.jsx)(s.code,{children:"sheet ids"})," can be added."]}),"\n",(0,t.jsxs)(s.li,{children:["To get the google sheet ids, click on \u201cedit\u201d icon on the ",(0,t.jsx)(s.code,{children:"google sheets"}),", next to the sheet name."]}),"\n",(0,t.jsx)(s.li,{children:"Find the url you\u2019re on and get the numeric part as shown in the screenshot"}),"\n"]}),"\n",(0,t.jsx)("img",{width:"633",height:"413",alt:"Screenshot 2025-07-16 at 10 27 23\u202fPM",src:"https://github.com/user-attachments/assets/38ca6958-53c5-4618-88e3-18bff854e030"}),"\n",(0,t.jsx)(s.h4,{id:"step-2-set-up-the-google-app-script",children:"Step 2: Set Up the Google App Script"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Go to Extensions -> App script"}),"\n",(0,t.jsxs)(s.li,{children:["Go to ",(0,t.jsx)(s.code,{children:"Editor"})," page to see the code"]}),"\n",(0,t.jsx)(s.li,{children:"Replace the \u201cYOUR-NGO-SHORTCODE\u201d with you the shortcode you use to open your glific\u2019s log-in page, on line 2 and line 28"}),"\n",(0,t.jsx)(s.li,{children:"Add your user phone no and password on line 5 and line 6 respectively. This is used to perform the first step of logging in, and retrieving the \u201caccess_token\u201d which is used to call \u201csync a sheet\u201d API or any other Glific API."}),"\n"]}),"\n",(0,t.jsx)("img",{width:"624",height:"328",alt:"Screenshot 2025-07-16 at 10 30 19\u202fPM",src:"https://github.com/user-attachments/assets/bb6af74f-0e01-4f66-a76d-71a08c7c7e3b"}),"\n",(0,t.jsxs)(s.ol,{start:"5",children:["\n",(0,t.jsx)(s.li,{children:"Replace \u201cYOUR-EMAIL-ID\u201d on line 165 in order to get notifications to your email, incase this function fails."}),"\n"]}),"\n",(0,t.jsx)("img",{width:"616",height:"433",alt:"Screenshot 2025-07-16 at 10 30 56\u202fPM",src:"https://github.com/user-attachments/assets/080087ab-d11f-456e-9390-81aff64dea27"}),"\n",(0,t.jsxs)(s.ol,{start:"6",children:["\n",(0,t.jsxs)(s.li,{children:["Run the ",(0,t.jsx)(s.code,{children:"syncMultipleSheetsWithRetryAndNotify"})," function"]}),"\n"]}),"\n",(0,t.jsx)("img",{width:"622",height:"409",alt:"Screenshot 2025-07-16 at 10 31 24\u202fPM",src:"https://github.com/user-attachments/assets/4e4dbe74-4399-40e9-994d-ace501d702c1"}),"\n",(0,t.jsxs)(s.ol,{start:"7",children:["\n",(0,t.jsx)(s.li,{children:"Provide any requisite permissions that is asked (if any)"}),"\n",(0,t.jsxs)(s.li,{children:["Confirm the Col B and C are updated in the ",(0,t.jsx)(s.code,{children:"SheetList"})," tab"]}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"step-3-set-up-a-trigger-to-run-daily",children:"Step 3: Set up a Trigger to Run Daily"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"In the App Script editor, go to Triggers \u2192 Add Trigger"}),"\n",(0,t.jsxs)(s.li,{children:["Choose function ",(0,t.jsx)(s.code,{children:"syncMultipleSheetsWithRetryAndNotify"})]}),"\n",(0,t.jsx)(s.li,{children:"Select type: Time-driven"}),"\n",(0,t.jsx)(s.li,{children:"Run daily or multiple times a day depending on your sync schedule"}),"\n"]}),"\n",(0,t.jsx)("img",{width:"633",height:"360",alt:"Screenshot 2025-07-16 at 10 34 56\u202fPM",src:"https://github.com/user-attachments/assets/400180c5-e853-4d67-8b89-fe45fab8300d"}),"\n",(0,t.jsx)(s.h3,{id:"benefits",children:"Benefits"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Handles large-scale sheet syncs"}),"\n",(0,t.jsx)(s.li,{children:"Works outside of Glific\u2019s autosync limits"}),"\n",(0,t.jsx)(s.li,{children:"Automatically retries on failure"}),"\n",(0,t.jsx)(s.li,{children:"Logs and notifies team for easy debugging"}),"\n"]})]})}function d(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>a});var t=n(6540);const i={},o=t.createContext(i);function r(e){const s=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(o.Provider,{value:s},e.children)}}}]);